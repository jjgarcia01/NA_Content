namespace: na_content
operation:
  name: generic_na_operation
  python_action:
    use_jython: false
    script: "# do not remove the execute function\ndef execute():\n    # code goes here\n# you can add additional helper methods below.\n#!/usr/bin/python3\n\n\n\n    import requests\n    import json\n    import re\n    import datetime\n    from datetime import date\n    import pprint\n\n\n    api_url = \"https://na1.advantageinc.org/nom/api/automation/v1/wrapper\"\n\n    requests.packages.urllib3.disable_warnings()\n\n####################################################\n# Retrieve OAuth2 Token\n####################################################\n\n    \n# Use this URL to authenticate when NA/NNM are integrated\n    loginurl = \"https://nnmi.advantageinc.org/idp/oauth2/token\"\n    # Use this URL to authenticate when NA is standalone\n    #loginurl = \"https://na1.advantageinc.org/nom-na/idp/oauth2/token\"\n\n#    payload='grant_type=password&username=matt&password=matt&client_id=id1&client_secret=secret1'\n#    headers = {\n#      'Content-Type': 'application/x-www-form-urlencoded',\n#      'Cookie': 'JSESSIONID=c082kHsvKMtVDUr6yLf9lT0CmBmIIQg1f7LzxItp.nmccloudvm456; NMSOBTURATE=SP4217OMQDZVCN07D49JEWA55S7GI8NI',\n#    }\n\n    payload='grant_type=password&username=matt&password=matt&client_id=id1&client_secret=secret1'\n    headers = {\n      'Content-Type': 'application/x-www-form-urlencoded'\n    }\n\n    try:\n      response = requests.request(\"POST\", loginurl, headers=headers, data=payload, verify=False)\n      response.raise_for_status()\n    except requests.exceptions.HTTPError as err:\n      raise SystemExit(err)\n\n    resp = response.json()\n    token = 'Bearer ' + resp['access_token']\n\n\n###################################################\n# List Device: \n#\n# The script is hardcoded to list the \"adelaide\"\n# device. The full response is printed as well as\n# an example of referencing a single element from\n# the response.\n# \n###################################################\n\n    payload = json.dumps({\n      \"command\": \"list device\",\n      \"parameters\": {\n       \"host\": \"adelaide\"\n      }\n    })\n    headers = {\n      'Content-Type': 'application/json',\n      'Authorization': token\n    }\n    \n    try:\n       response = requests.request(\"POST\", api_url, headers=headers, data=payload, verify=False)\n       response.raise_for_status()\n    except requests.exceptions.HTTPError as err:\n        raise SystemExit(err)\n\n    device_info = json.dumps(response.json(), indent = 3)\n    return {\"naOutput\" : device_info}"
  outputs:
    - naOutput
  results:
    - SUCCESS
